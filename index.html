<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Growlauncher By Hady</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg1: #0f1724;
  --bg2: #061627;
  --accent1: #7b61ff;
  --accent2: #00e0ff;
  --white: #eaf2ff;
}
* {box-sizing:border-box;font-family:"Poppins",sans-serif;margin:0;padding:0;}
html, body {height:100%;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--white);display:flex;justify-content:center;align-items:flex-start;padding-top:20px;}
.card {width:360px;max-width:95%;padding:36px;border-radius:16px;background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));box-shadow:0 8px 40px rgba(2,6,23,0.6);text-align:center;display:flex;flex-direction:column;}
h2 {font-weight:800;font-size:24px;margin-bottom:6px;}
.subtitle {font-size:14px;color:rgba(234,242,255,0.82);margin-bottom:12px;} 
input {width:100%;padding:10px 12px;margin:6px 0;border-radius:10px;border:none;background:rgba(255,255,255,0.05);color:var(--white);}
button {padding:12px 18px;border:none;border-radius:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#061026;font-weight:700;cursor:pointer;width:100%;margin:6px 0;}
.hidden {display:none;}
.muted {color:rgba(234,242,255,0.7);margin-top:8px;font-size:13px;}
hr {border:none;border-top:1px solid rgba(255,255,255,0.2);margin:12px 0;}
#redirecting {color:var(--accent2);font-weight:700;margin-top:8px;font-size:14px;}
#adminPanel {display:flex;flex-direction:column;margin-top:12px;max-height:400px;}
#adminSearchInput {margin-bottom:12px;}
#adminCodesContainer {overflow-y:auto;flex:1;position:relative;max-height:340px;}
</style>
</head>
<body>
<div class="card">
  <div class="logo" style="width:72px;height:72px;margin:0 auto 12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;color:#061026;font-size:22px;">GL</div>
  <h2>Growlauncher Update & Scripts By Hady</h2>
  <div class="subtitle">Discord: <strong>Hady0717</strong></div>

  <button id="getBtn">Get Growlauncher</button>

  <div id="panel" class="hidden">
    <input id="codeInput" placeholder="Enter your code">
    <button id="submitBtn">Submit</button>
    <div id="message" class="muted"></div>
    <div id="redirecting" class="hidden">Redirecting<span id="dots">...</span></div>

    <hr>

    <input id="userSearchInput" placeholder="Enter your code to check uses">
    <button id="userSearchBtn">Search Code</button>
    <div id="userSearchMsg" class="muted"></div>

    <hr>
  </div>

  <button id="adminBtn">Control Panel</button>
  <div id="adminLoginPanel" class="hidden" style="margin-top:12px;">
    <input id="adminPasswordInput" type="password" placeholder="Password">
    <button id="adminLoginBtn">Login</button>
    <div id="adminLoginMsg" class="muted"></div>
  </div>

  <!-- Admin Panel Hidden Initially -->
  <div id="adminPanel" class="hidden">
    <!-- Logout and Reset Buttons will be dynamically added here -->
    <input id="adminSearchInput" class="hidden" placeholder="Search codes by number">
    <div id="adminCodesContainer"></div>
  </div>

  <footer id="footer">© Hady — Growlauncher</footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAdJeuG7w4khT4B6Yq5wWBbDYKfCdvWn8w",
  authDomain: "growlauncher-0.firebaseapp.com",
  projectId: "growlauncher-0",
  storageBucket: "growlauncher-0.firebasestorage.app",
  messagingSenderId: "205612782940",
  appId: "1:205612782940:web:3ec9eb98624158b2829d99"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// User elements
const getBtn = document.getElementById("getBtn");
const panel = document.getElementById("panel");
const codeInput = document.getElementById("codeInput");
const submitBtn = document.getElementById("submitBtn");
const message = document.getElementById("message");
const redirecting = document.getElementById("redirecting");
const dots = document.getElementById("dots");
const userSearchInput = document.getElementById("userSearchInput");
const userSearchBtn = document.getElementById("userSearchBtn");
const userSearchMsg = document.getElementById("userSearchMsg");

// Admin elements
const adminBtn = document.getElementById("adminBtn");
const adminLoginPanel = document.getElementById("adminLoginPanel");
const adminPasswordInput = document.getElementById("adminPasswordInput");
const adminLoginBtn = document.getElementById("adminLoginBtn");
const adminLoginMsg = document.getElementById("adminLoginMsg");
const adminPanel = document.getElementById("adminPanel");
const adminSearchInput = document.getElementById("adminSearchInput");
const codesContainer = document.getElementById("adminCodesContainer");

const ADMIN_PASSWORD = "53785";
let isAdmin=false;

// Show user panel
getBtn.addEventListener("click",()=>{
  panel.classList.remove("hidden");
  getBtn.classList.add("hidden");
  codeInput.focus();
});

// User code submission
submitBtn.addEventListener("click", handleSubmit);
codeInput.addEventListener("keydown", e=>{if(e.key==="Enter") handleSubmit();});

async function handleSubmit(){
  const code=(codeInput.value||"").trim().toUpperCase();
  if(!code){message.textContent="Please enter a code.";return;}
  try{
    const codeRef=doc(db,"licenses",code);
    const codeSnap=await getDoc(codeRef);
    if(!codeSnap.exists()){message.textContent="Invalid code."; return;}
    const data=codeSnap.data();
    if(data.uses<=0){message.textContent="This code has been used up."; return;}
    await updateDoc(codeRef,{uses:data.uses-1});
    message.textContent=`Code accepted. Remaining uses: ${data.uses-1}`;

    redirecting.classList.remove("hidden");
    let dotCount=0;
    const interval=setInterval(()=>{dotCount=(dotCount+1)%4; dots.textContent='.'.repeat(dotCount);},500);
    setTimeout(()=>{clearInterval(interval); redirecting.classList.add("hidden"); window.location.href="https://www.dropbox.com/scl/fi/ik12g46som83zxy1auqqw/Discord-Hady0717-Growlauncher-v6.1.43.apk?dl=1";},5000);

  }catch(err){console.error(err); message.textContent="Error checking code. Try again.";}
}

// User search
userSearchBtn.addEventListener("click", handleUserSearch);
userSearchInput.addEventListener("keydown", e=>{if(e.key==="Enter") handleUserSearch();});
async function handleUserSearch(){
  const searchVal=(userSearchInput.value||"").trim().toUpperCase();
  if(!searchVal){userSearchMsg.textContent=""; return;}
  const codesCol=collection(db,"licenses");
  const snapshot=await getDocs(codesCol);
  let found=false;
  snapshot.forEach(docSnap=>{
    const codeStr=docSnap.id.toUpperCase();
    if(codeStr.includes(searchVal)){
      const data=docSnap.data();
      userSearchMsg.textContent=`${docSnap.id} — Uses remaining: ${data.uses}`;
      found=true;
    }
  });
  if(!found) userSearchMsg.textContent="No matching code found.";
}

// Admin panel toggle
adminBtn.addEventListener("click",()=>{
  if(isAdmin){isAdmin=false; adminPanel.classList.add("hidden"); adminLoginPanel.classList.add("hidden"); return;}
  adminLoginPanel.classList.toggle("hidden"); adminPasswordInput.focus();
});

// Admin login
adminLoginBtn.addEventListener("click", async ()=>{
  const pw=adminPasswordInput.value.trim();
  if(pw===ADMIN_PASSWORD){
    isAdmin=true;
    adminPanel.classList.remove("hidden");
    adminSearchInput.classList.remove("hidden");
    adminLoginPanel.classList.add("hidden");
    adminBtn.classList.add("hidden");
    adminPasswordInput.value="";
    adminLoginMsg.textContent="";
    await loadAdminCodes(true);
  } else {adminLoginMsg.textContent="Incorrect password.";}
});

// Load admin codes with Logout & Reset buttons at top
async function loadAdminCodes(showTopBtns=false){
  codesContainer.innerHTML="";
  if(showTopBtns){
    const logoutBtn=document.createElement("button");
    logoutBtn.textContent="Logout";
    logoutBtn.addEventListener("click", ()=>{
      isAdmin=false; adminPanel.classList.add("hidden"); adminSearchInput.classList.add("hidden"); adminBtn.classList.remove("hidden"); codesContainer.innerHTML="";
    });
    const resetAllBtn=document.createElement("button");
    resetAllBtn.textContent="Reset All Users";
    resetAllBtn.addEventListener("click", async ()=>{
      const codesCol=collection(db,"licenses");
      const snapshot=await getDocs(codesCol);
      snapshot.forEach(async docSnap=>{await updateDoc(doc(db,"licenses",docSnap.id),{uses:3});});
      await loadAdminCodes(true);
    });
    codesContainer.appendChild(logoutBtn);
    codesContainer.appendChild(resetAllBtn);
  }

  const codesCol=collection(db,"licenses");
  const snapshot=await getDocs(codesCol);
  snapshot.forEach(docSnap=>{
    const codeStr=docSnap.id;
    const data=docSnap.data();
    const div=document.createElement("div");
    div.style.margin="6px 0";
    div.innerHTML=`<span>${codeStr} — Uses: ${data.uses}</span> <button style="margin-top:4px;">Reset Uses</button>`;
    const btn=div.querySelector("button");
    btn.addEventListener("click", async ()=>{
      await updateDoc(doc(db,"licenses",codeStr),{uses:3});
      await loadAdminCodes(true);
    });
    codesContainer.appendChild(div);
  });
}

// Admin search
adminSearchInput.addEventListener("keydown", async e=>{
  if(e.key==="Enter"){
    const val=(adminSearchInput.value||"").trim();
    codesContainer.innerHTML="";
    const logoutBtn=document.createElement("button");
    logoutBtn.textContent="Logout";
    logoutBtn.addEventListener("click", ()=>{
      isAdmin=false; adminPanel.classList.add("hidden"); adminSearchInput.classList.add("hidden"); adminBtn.classList.remove("hidden"); codesContainer.innerHTML="";
    });
    const resetAllBtn=document.createElement("button");
    resetAllBtn.textContent="Reset All Users";
    resetAllBtn.addEventListener("click", async ()=>{
      const codesCol=collection(db,"licenses");
      const snapshot=await getDocs(codesCol);
      snapshot.forEach(async docSnap=>{await updateDoc(doc(db,"licenses",docSnap.id),{uses:3});});
      await loadAdminCodes(true);
    });
    codesContainer.appendChild(logoutBtn);
    codesContainer.appendChild(resetAllBtn);

    const codesCol=collection(db,"licenses");
    const snapshot=await getDocs(codesCol);
    snapshot.forEach(docSnap=>{
      const codeStr=docSnap.id;
      if(codeStr.includes(val)){
        const data=docSnap.data();
        const div=document.createElement("div");
        div.style.margin="6px 0";
        div.innerHTML=`<span>${codeStr} — Uses: ${data.uses}</span> <button style="margin-top:4px;">Reset Uses</button>`;
        const btn=div.querySelector("button");
        btn.addEventListener("click", async ()=>{
          await updateDoc(doc(db,"licenses",codeStr),{uses:3});
          await loadAdminCodes(true);
        });
        codesContainer.appendChild(div);
      }
    });
  }
});

// Restore all codes if admin search emptied
adminSearchInput.addEventListener("input", async ()=>{
  if(adminSearchInput.value.trim()===""){ await loadAdminCodes(true); }
});
</script>
</body>
</html>


